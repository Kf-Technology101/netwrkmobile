<div id="mapElement" #mapElement ></div>
<ion-header class="incognito-header" isScrolling="false" [ngClass]="{'chat-header': !isUndercover, 'fully-disabled': chatPrvd.isLobbyChat && !chatPrvd.areaLobby }">  
  <ion-toolbar *ngIf="isUndercover && chatPrvd.getState() == 'undercover' && !chatPrvd.areaLobby && !netwrkFeed && !settings.isNewlineScope">
  <!--<ion-toolbar>-->
	
	<!-- <span class="info">
	  <span *ngIf="slideAvatarPrvd.sliderPosition == 'left'" class="username" >
		{{ user.name }}
	  </span>
	  <span *ngIf="slideAvatarPrvd.sliderPosition == 'right'" class="username">
		{{ user.role_name }}
	  </span> 
	</span>  -->
	
    <div class="drag-container profile-dragger" [@sliderState]="topSlider.getState()">
      <div class="dragline" (click)="goToProfile(user.id, user.profileTypePublic, user.role_name)" [ngClass]="{'landing-lobby': isUndercover && chatPrvd.getState() == 'undercover','area-lobby': !isUndercover && chatPrvd.getState() == 'area'}">
        <span class="info">
        </span>  
        <img src="assets/icon/slider_arrow.svg" class="arrow-ico icon">
        <img class="draggable-element" [src]="slideAvatarPrvd.sliderPosition == 'right' ? user.hero_avatar_url : user.avatar_url"
          (error)="chatPrvd.updateAvatarUrl($event)">
      </div>
    </div>
	
	<div ion-text color="bk" class="area-subhead-tip" [ngClass]="{'landing-lobby-area-tip': isUndercover && chatPrvd.getState() == 'undercover'}">
		<span class="subhead-container" (click)="resetTopNetwrkFilter()">
			
			<div class="flex-ch netwrk-name">
				<span *ngIf="chatPrvd.holdFilter" class="username" >
					Local
				</span>
				<span *ngIf="!chatPrvd.holdFilter" class="username">
					All
				</span>
			</div>
			
			<div class="flex-ch">
				<button ion-button class="netwrk-icon">
					<img class="netwrk-img" src="assets/icon/blue.png">
				</button>
			</div>
			
			<div class="flex-ch">
				<span class="netwrk-users">{{chatPrvd.postMessages.length}} </span> 
				<img src="assets/icon/netwrk-chat.png" class="netwrk-chat-icon">
			</div>
		</span>
	</div>
		

    <button *ngIf="chatPrvd.postMessages.length == 0 && !chatPrvd.postBtn.state && !settings.isNewlineScope"
            class="side refresh-btn top-icon" (tap)="refreshChat();initLpMap()"
            [hidden]="!canRefresh" ion-button>
      <ion-icon ios="ios-refresh-circle" md="ios-refresh-circle"></ion-icon>
    </button>

    <button ion-button class="side clear-btn" (tap)="clearMessages(chatPrvd.postMessages)"
            *ngIf="chatPrvd.postMessages.length > 0 && !chatPrvd.isLobbyChat">
      <!-- Clear --> Map
    </button>

  </ion-toolbar>

  
  <ion-toolbar [hidden]="postUnlock.hidden" [@slideState]="postUnlock.state" class="post-lock">
    <button ion-button class="send-request-btn" *ngIf="!postUnlockData.password" (click)="sendLineAccessRequest(postUnlockData.id)">
		Request Access
	</button>
    <form (submit)="unlockPost($event, unlockForm)" #unlockForm="ngForm">
      <input type="hidden" value="">
      <ion-item>
        <ion-input type="password" placeholder="Password" name="password"
          [(ngModel)]="postUnlockData.password" required></ion-input>
      </ion-item>
      <p ion-text class="password-hint" color="bk">Hint: {{ currentHint }}</p>
	 
      <button ion-button type="submit" class="unlock-line-btn" *ngIf="postUnlockData.password">Unlock it</button>
    </form>
	<span class="red" (click)="toggleTopSlider('unlock')"> Never Mind </span>
  </ion-toolbar>

  
  <ion-toolbar [hidden]="postLock.hidden" [@slideState]="postLock.state" class="post-lock">
    <form (submit)="sendLockInfo($event, lockForm)" #lockForm="ngForm">
      <ion-item>
        <ion-input type="password" placeholder="Password" name="password"
          [(ngModel)]="postLockData.password" required></ion-input>
      </ion-item>
      <ion-item>
        <ion-input type="text" placeholder="Hint" name="hint"
          [(ngModel)]="postLockData.hint" required></ion-input>
      </ion-item>
      <button ion-button type="submit" class="submit" *ngIf="postLockData.password && postLockData.hint">Lock it</button>
    </form>
  </ion-toolbar>

  <ion-toolbar [hidden]="postCustAddress.hidden" [@slideState]="postCustAddress.state" class="post-address">
    <form (submit)="sendCustAddressInfo($event, custAddressForm)" #custAddressForm="ngForm">
      <p class="address-label">Select a space to create a network in, or choose a location below.</p>
      <ion-item>
        <!-- <ion-input type="text" placeholder="Choose a place where you hang out!" name="custumAddress" [(ngModel)]="postCustAddressData.custumAddress" required (keyup)="updateNearByList()"> </ion-input> -->
		<ion-searchbar #searchbar placeholder="Enter address of a space near you" [hidden]="!search" [(ngModel)] = "searchModel" name="searchModelName"></ion-searchbar>	
      </ion-item>
		
      <button ion-button type="submit" class="submit" *ngIf="postCustAddressData.custumAddress">Submit</button>
    </form>
	
  </ion-toolbar>

	<ion-scroll scrollY="true" *ngIf="autocompleteItems.length" class="autocomplete-suggestions">
	  <ion-list>
		<ion-item *ngFor="let item of autocompleteItems" class="autocomplete-suggestion" (click)="chooseAddress(item)">
		{{ item.name }},{{ item.vicinity }}
		</ion-item>
	  </ion-list> 
	</ion-scroll>

  
  <!--Area Header-->
  <div *ngIf="!isUndercover && !netwrkFeed || !chatPrvd.areaLobby && chatPrvd.getState() == 'area' && !netwrkFeed" class="netwrk-header">
    <ion-toolbar class="area-head">
        <img class="ic user-icon" src="assets/images/sun_icon.png" (click)="goToLegendaryList()" style="float:left;width:34px;height:34px;">

        <div ion-text color="bk" class="area-subhead-tip">
           <span class="subhead-container" (click)="resetFilter()">
                <div class="flex-ch netwrk-name">
                    <span *ngIf="chatPrvd.areaFilter" class="username" >
                        Local<!-- {{ chatPrvd.localStorage.get('chat_zip_code')}} -->
                    </span>
                    <span *ngIf="!chatPrvd.areaFilter" class="username">
                        All
                    </span>
                </div>

                <div class="flex-ch">
                    <button ion-button class="netwrk-icon">
                        <img class="netwrk-img" src="assets/icon/blue.png">
                    </button>
                </div>
                <div class="flex-ch">
                    <span class="netwrk-users">{{uniqueUsers}} </span>  
					<span class="lobby-icon"></span>
                </div>
           </span>
        </div>
		
		<button *ngIf="chatPrvd.postMessages.length == 0 && !chatPrvd.postBtn.state && !accessDeniedTip"
            class="side refresh-btn top-icon" (tap)="refreshChat();initLpMap()"
            [hidden]="!canRefresh" ion-button>
			<ion-icon ios="ios-refresh-circle" md="ios-refresh-circle"></ion-icon>
		</button>
	
        <button ion-button class="side clear-btn legendary-icon" (tap)="clearMessages(chatPrvd.postMessages)" *ngIf="chatPrvd.postMessages.length > 0 && !chatPrvd.areaLobby">
           <!-- Clear --> Map
        </button>
    </ion-toolbar>
  </div>
  
    <div class="content areaLobby" *ngIf="chatPrvd.areaLobby">
        <div class="lobby-content chat-container visible">
            <div class="message 123" *ngFor="let message of chatPrvd.postAreaMessages; let i = index" [@fadeState]="'fadeInVeryFast'">
                <div class="message-container false isLobby">
            		<img (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)" src="{{loadImage(message)}}" class="chat-avatar 1 conversation" (error)="chatPrvd.updateAvatarUrl($event)">

                    <!-- <span class="chat-bubbles-box" *ngIf="chatPrvd.areaLobby">
                        <ion-icon ios="ios-chatbubbles-outline" md="ios-chatbubbles-outline"></ion-icon> : 8
                    </span> -->

                    <div class="message-item">
					  <div class="messageDiv">
                        <span class="username" *ngIf="message.user" (click)="openConversationLobbyForPinned(message)" (tap)="openConversationLobbyForPinned(message)">
                            <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
                                {{ message.title }}
                            </ng-container>
                            <ng-container *ngIf="!message.public && message.locked_by_user">
                                {{ message.role_name }}
                            </ng-container>
                        </span>

                        <span class="message-date" *ngIf="chatPrvd.areaLobby" (click)="openConversationLobbyForPinned(message)" (tap)="openConversationLobbyForPinned(message)">{{ message.dateStr }}</span> 

                        <span *ngIf="message.social" class="shared-status">Casted via {{ message.social }}
                         	<a *ngIf="message.post_url" href="#" (click)="openLinkInBrowser(message)" class="open-post" >	
                                <ion-icon ios="ios-open-outline" md="ios-open-outline"></ion-icon>
                            </a>
                        </span>

                        <span *ngIf="message.expire_at && !chatPrvd.isLobbyChat && chatPrvd.areaLobby" class="visible-for">
                            Expires in {{ message.expire_at }}
                        </span>

                        <ng-container *ngIf="chatPrvd.areaLobby && !message.locked_by_user || chatPrvd.areaLobby && (message.locked_by_user && user.id == message.user_id)">
                            <span *ngIf="message.text_with_links" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="toolsPrvd.handleLinkClick($event)"></span>
                        </ng-container> 
				
					  </div>
					  
					  <div class="accessDiv" *ngIf = "chatPrvd.currentLobby.isAddButtonAvailable && user.id != message.user_id">
						<button ion-button class="accept-access accessBtn" (click)="grantAccess('ACCEPT',message)">
							I'm in
						</button>

						<button ion-button class="reject-access accessBtn" (click)="grantAccess('REJECT',message)">
							I can't
						</button>
					  </div>
		
                    </div>

                    <ng-container *ngIf="message.locked_by_user && user.id == message.user_id || !message.locked_by_user">
                        <ng-container *ngIf="message.image_urls.length + message.video_urls.length >= 1">
                            <ng-container *ngIf="message.image_urls.length > 0"> 
                                <img (click)="imageViewer(message.image_urls[0])" class="img-ico" src="{{message.image_urls[0]}}" (load)="chatPrvd.calcLoadedImages()"/>
                            </ng-container>
                            <ng-container *ngIf="message.video_urls.length > 0">
                                <div class="video-container" (tap)="videoservice.toggleVideoVolume($event)">
                                    <ion-icon class="volume" ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                                    <video loop playsinline muted [poster]="message.video_urls[0].poster">
                                        <source [src]="message.video_urls[0].url">
                                    </video>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>

</ion-header>
<!--Lobby Header-->
<ion-header *ngIf="(chatPrvd.isLobbyChat || netwrkFeed) && !chatPrvd.areaLobby" class="lobby-header">
 
	<ion-toolbar>
      <ion-slides slidesPerView="5" class="netwrk-slider">
          <ion-slide *ngFor="let user of chatPrvd.currentLobby.users; let i = index" class="netwrk-slide">
              <div (tap)="goToProfile(user.id,user.public, user.role_name)">
                <img class="ic user-icon" [src]="user.avatar_url ? user.avatar_url : user.hero_avatar_url" (error)="chatPrvd.updateAvatarUrl($event)">
				<span class="username">{{user.name}}</span>
              </div>
          </ion-slide>

          <ion-slide class="netwrk-slide" (click)="shareLineJoinFlow(chatPrvd.currentLobbyMessage)" *ngIf="chatPrvd.currentLobby.isAddButtonAvailable">
            <button class="join-chat">+</button>
          </ion-slide>
      </ion-slides>
    </ion-toolbar>

    <ion-toolbar class="area-head">
	
          <div ion-text color="bk" class="lines-subhead-tip">
              <span class="subhead-container">
                <div class="flex-ch netwrk-name">
                    <span class="text">
                         {{ chatPrvd.currentLobbyMessage.title }}
                    </span>
                </div>
				<div class="flex-ch netwrk-feed-btn" style="width: 25%;">
                    <button ion-button class="netwrk-icon" (click)="netwrkFeed?getLobbyMessages(chatPrvd.currentLobbyMessage):getNetwrkFeedLines()">
                        <img class="netwrk-img"  src="assets/icon/netwrk-chat.png">
                    </button>
                </div>
                <div class="flex-ch">
					<span class="netwrk-users"> {{chatPrvd.currentLobbyMessage.points}} </span>
                    <span class="lobby-icon"></span>  
					<span class="netwrk-place"> {{chatPrvd.currentLobbyMessage.place_name}} </span>
                </div>
              </span>
          </div>
    </ion-toolbar>
</ion-header>

<ion-content has-main-btn has-main-btn-label no-bounce scroll="true" (ionScroll)="processOnScroll($event)" (ionScrollEnd)="listenForScrollEnd($event)" 
  
  [ngClass] = "{'no-height': chatPrvd.postMessages.length<1, 'netwrk-content': chatPrvd.getState() == 'area', 'lobby-content': chatPrvd.isLobbyChat && !chatPrvd.areaLobby, 'white-undercover': isUndercover && (chatPrvd.localStorage.get('enable_uc_camera') == false || chatPrvd.localStorage.get('enable_uc_camera') === null || chatPrvd.isLobbyChat), 'white-undercover': chatPrvd.getState() == 'undercover'}"
  
  [ngStyle]="{'padding-bottom': contentPadding, 'margin-bottom': contentMargin, 'position':contentPosition,'margin-top':contentMarginTop}" 
  
  class="my-content" *ngIf="!settings.isNewlineScope" >

  <ion-refresher (ionRefresh)="refreshChat($event)" *ngIf="!netwrkFeed">
    <ion-refresher-content pullingIcon="arrow-dropdown" refreshingSpinner="ios"></ion-refresher-content>
  </ion-refresher>
 
  <div id="places"></div>

<div class="chat-container visible" #chatContainer [ngClass]="{ 'undercover' : chatPrvd.getState() == 'undercover', 'lobby' : chatPrvd.isLobbyChat, 'areaMessageLobby' : chatPrvd.areaLobby }" >

    <p *ngIf="chatPrvd.postMessages.length == 0 && (isUndercover || !isUndercover || chatPrvd.isLobbyChat) && !accessDeniedTip" class="no-data-message abs">There are no posts yet</p>
	<p *ngIf="accessDeniedTip" class="no-data-message abs">Need location to show you what’s nearby!</p>
	
    <div class="message 456" *ngFor="let message of chatPrvd.postMessages; let i = index" [@fadeState]="'fadeInVeryFast'">
	  
	  <div class="message-container false" 
	  *ngIf="!message.social && !chatPrvd.areaLobby && !message.undercover && !chatPrvd.isLobbyChat && isUndercover && message.messageable_type == 'Network' && message.conversation_status != 'REJECTED'">

		<img (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)"
         src="{{loadImage(message)}}" class="chat-avatar 2"
        (error)="chatPrvd.updateAvatarUrl($event)">
				
       <!--  <span class="message-count conversasion-cnt" *ngIf="!chatPrvd.isLobbyChat && chatPrvd.getState() == 'undercover' && message.messageable_type=='Network'">1</span> -->

        <!-- <span class="chat-bubbles-box" *ngIf="!chatPrvd.areaLobby">
            <ion-icon ios="ios-chatbubbles-outline" md="ios-chatbubbles-outline"></ion-icon> : 8
        </span> -->

        <p class="message-item">

          <span class="username" *ngIf="message.user && message.messageable_type=='Network'" (click)="openConversationLobbyForPinned(message)" (tap)="openConversationLobbyForPinned(message)">
            <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
				{{ message.title }}
			</ng-container>
			<ng-container *ngIf="!message.public && message.locked_by_user">
				{{ message.role_name }}
			</ng-container>
          </span>

          <span class="username" *ngIf="message.user && message.messageable_type=='Room'" (click)="openConversationMessage(message)" (tap)="openConversationMessage(message)">
            <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
            {{ message.user.name }}
            </ng-container>
            <ng-container *ngIf="!message.public && message.locked_by_user">
            {{ message.user.role_name }}
            </ng-container>
          </span>
		
		<!-- {{message.user.name}} -->
          <!-- <span class="message-user"><data class="message-date">{{ message.dateStr }}</data> {{ message.place_name}}</span> -->

          <!-- <span *ngIf="message.social" class="shared-status">Casted via {{ message.social }}
            <a *ngIf="message.post_url" href="#" (click)="openLinkInBrowser(message)" class="open-post" >	
              <ion-icon ios="ios-open-outline" md="ios-open-outline"></ion-icon>
            </a>
          </span> -->

          <span class="date-visible-for">
            {{ message.dateStr }}
          </span>
		  <!--<span *ngIf="message.expire_at && !chatPrvd.isLobbyChat" class="visible-for">
            Expires in {{ message.expire_at }}
          </span> -->

          <ng-container *ngIf="message.locked">
            <ion-icon ios="ios-lock" md="ios-lock" class="locked-by-you info-icon"></ion-icon>
          </ng-container>

          <!-- <ng-container *ngIf="!message.locked_by_user || (message.locked_by_user && user.id == message.user_id)">
                <span *ngIf="message.text_with_links && message.messageable_type=='Network'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="openConversationLobbyForPinned(message)"></span>
                <span *ngIf="message.text_with_links && message.messageable_type=='Room'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="openConversationMessage(message)"></span>
          </ng-container> -->

          <img src="assets/icon/slider_arrow.svg" class="conversation_right_ico" *ngIf="chatPrvd.getState() != 'undercover' && message.message_type != 'LOCAL_MESSAGE'"  (tap)="openFeedbackModal(message, i)"  (press)="openFeedbackModal(message, i)">
        </p>

		<div class="accessDiv" 
		*ngIf = "message.conversation_status && user.id != message.user_id && message.conversation_status=='REQUESTED'"> <!-- *ngIf = "message.conversation_status" -->
			<button ion-button class="accept-access accessBtn" (click)="grantAccess('ACCEPT',message)" >
				I'm in
			</button>

			<button ion-button class="reject-access accessBtn" (click)="grantAccess('REJECT',message)" >
				I can't
			</button>
		</div> 
		
        <ng-container *ngIf="user.id != message.user_id && message.locked_by_user">
          <button class="feedback-button lock" (tap)="showUnlockPostForm(message.id, message.hint)">
            <ion-icon ios="ios-lock" md="ios-lock"></ion-icon>
          </button>
        </ng-container>

        <span class="img-wrapper">
            <ng-container *ngIf="message.locked_by_user && user.id == message.user_id || !message.locked_by_user">
              <ion-slides *ngIf="message.image_urls.length + message.video_urls.length > 1" pager="true" (ionSlideDidChange)="videoservice.messageSliderChange($event, pageTag)">
                <ion-slide *ngFor="let img of message.image_urls">
                  <img (click)="imageViewer(img)" class="resize-img" [src]="img" (load)="chatPrvd.calcLoadedImages()"/>
                </ion-slide>
                <ion-slide *ngFor="let vid of message.video_urls" (tap)="videoservice.toggleVideoVolume($event)" class="video-container">
                  <ion-icon class="volume" ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                  <video [poster]="vid.poster" loop playsinline muted>
                    <source [src]="vid.url">
                  </video>
                </ion-slide>
              </ion-slides>
              <ng-container *ngIf="message.image_urls.length + message.video_urls.length <= 1">
                <ng-container *ngIf="message.image_urls.length > 0">
                  <img class="resize-img"*ngFor="let j of message.image_urls" src="{{j}}" (load)="chatPrvd.calcLoadedImages()" (click)="imageViewer(j)"/>
                </ng-container>
                <ng-container *ngIf="message.video_urls.length > 0">
                  <div class="video-container" (tap)="videoservice.toggleVideoVolume($event)">
                    <ion-icon class="volume"
                    ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                    <video *ngFor="let vid of message.video_urls" loop playsinline muted [poster]="vid.poster">
                      <source [src]="vid.url">
                    </video>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>
        </span>
			
      </div>
    </div>
	
	
    <div class="message 789" *ngFor="let message of chatPrvd.postMessages; let i = index" [@fadeState]="'fadeInVeryFast'">
		
	  <div 
	  *ngIf="!message.has_expired && message.undercover && chatPrvd.getState() == 'undercover' && (message.is_followed || message.user_id == user.id || message.user_id != user.id) && message.message_type !='ACCESS_REQUEST' && message.message_type != 'CONV_REQUEST' && !chatPrvd.isLobbyChat && message.message_type !='CONV_REJECTED' && message.conversation_status!='REJECTED' 
	  || chatPrvd.isLobbyChat && !message.has_expired && isUndercover && (message.message_type !='ACCESS_REQUEST'  && message.message_type != 'CONV_REQUEST' && message.messageable_type !='Network' || message.isMain) && message.message_type !='CONV_REJECTED' && message.conversation_status!='REJECTED' 
	  || !chatPrvd.isLobbyChat && chatPrvd.areaLobby && message.message_type !='ACCESS_REQUEST'  && message.message_type != 'CONV_REQUEST' && !message.line_locked_by_user && chatPrvd.getState() == 'area' && message.message_type !='CONV_REJECTED' && message.conversation_status!='REJECTED' 
	  || chatPrvd.getState() == 'area' && message.undercover && !message.has_expired && message.message_type !='ACCESS_REQUEST'  && message.message_type != 'CONV_REQUEST' && !message.line_locked_by_user && !chatPrvd.isLobbyChat && message.message_type !='CONV_REJECTED' && message.conversation_status!='REJECTED'" 
	  
	  [ngClass]="{'active-cl' : message.addClass, 'message-network' : message.messageable_type == 'Network', 'message-msg' : message.messageable_type == 'Room','message-reply':message.messageable_type == 'Reply', 'message-text':message.messageable_type == 'Room' || message.messageable_type == 'Network' }">
	  
		<img (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)" src="{{loadImage(message)}}" class="chat-avatar 3" (error)="chatPrvd.updateAvatarUrl($event)" *ngIf="message.user_id != user.id">
		
		<img (click)="editSetting(message.id)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)" src="{{loadImage(message)}}" class="chat-avatar 3" (error)="chatPrvd.updateAvatarUrl($event)" *ngIf="message.user_id == user.id">
				
        <!-- <span class="message-count" *ngIf="!chatPrvd.isLobbyChat && chatPrvd.getState() == 'undercover'">1</span>  -->

        <p class="message-item message-container" (click)="openReplyLobby(message)" 
		[ngClass]="{'p-message':message.conversation_status && user.id != message.user_id && message.conversation_status=='REQUESTED'}"> 

             <!-- <span class="location" *ngIf="message.place_name && message.messageable_type=='Network' && !chatPrvd.areaLobby && (!chatPrvd.isLobbyChat || netwrkFeed) && (message.public || !message.public && message.locked) " (click)="normalizeMainBtn($event); viewLineLocation(message)">
                <ng-container >
                    {{ message.place_name }}
                </ng-container>
             </span> -->
			 <span class="users-count" *ngIf="message.users_count > 1"><img src="assets/icon/like.png">{{ message.users_count }}</span>
			 
             <span class="username" *ngIf="message.user && message.messageable_type=='Network'" (click)="normalizeMainBtn($event); openLobbyForPinned(message)">
                <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
                {{ message.title }}
                </ng-container>
                <ng-container *ngIf="!message.public && message.locked_by_user">
                {{ message.role_name }}
                </ng-container>
             </span>

             <span class="username" *ngIf="message.user && message.messageable_type=='Room'" (click)="normalizeMainBtn($event); openLobbyForLineMessage(message)">
                <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
                {{ message.user.name }}
                </ng-container>
                <ng-container *ngIf="!message.public && message.locked_by_user">
                {{ message.user.role_name }}
                </ng-container>
              </span>
			  
			  <span class="username" *ngIf="message.user && message.messageable_type=='Reply'" >
                <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
                {{ message.user.name }}
                </ng-container>
                <ng-container *ngIf="!message.public && message.locked_by_user">
                {{ message.user.role_name }}
                </ng-container>
              </span>
			  
			  <span class="access-type" *ngIf = "message.public && message.messageable_type == 'Network'">Public</span>
			  <span class="access-type"  *ngIf = "!message.public && message.messageable_type == 'Network'">Private</span>
              
			  <span class="message-date" *ngIf = "message.messageable_type == 'Room'">{{ message.dateStr }}</span>
			 
			  <span class="message-date"  *ngIf="message.reply_count && message.messageable_type == 'Room'"> <b>{{ message.reply_count }} </b>
			  <b *ngIf="message.reply_count && message.reply_count > 1"> Replies</b>
			  <b *ngIf="message.reply_count && message.reply_count == 1"> Reply</b>
			  </span> 

              <span *ngIf="message.social" class="shared-status">Casted via {{ message.social }}
                <a *ngIf="message.post_url" href="#" (click)="openLinkInBrowser(message)" class="open-post" >	
                  <ion-icon ios="ios-open-outline" md="ios-open-outline"></ion-icon>
                </a>
              </span>

              <span *ngIf="message.expire_at && !chatPrvd.isLobbyChat && message.messageable_type == 'Room'" class="visible-for">
                Expires in {{ message.expire_at }}
              </span> 

              <ng-container *ngIf="message.expire_at && !message.has_expired && !chatPrvd.isLobbyChat">
                 <ion-icon ios="ios-timer-outline" md="ios-timer-outline"  class="will-expire info-icon"></ion-icon>
              </ng-container>

              <ng-container *ngIf="message.locked">
                <ion-icon ios="ios-lock" md="ios-lock" class="locked-by-you info-icon"></ion-icon>
              </ng-container>

             <ng-container *ngIf="!message.locked_by_user && message.messageable_type == 'Network' && chatPrvd.isLobbyChat|| !message.locked_by_user && message.messageable_type == 'Room' || (message.locked_by_user && user.id == message.user_id) && message.messageable_type == 'Room'">
			  
                <span *ngIf="message.text_with_links && message.messageable_type=='Network'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="openLobbyForPinned(message)"></span>

                <span *ngIf="message.text_with_links && message.messageable_type=='Room'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="openLobbyForLineMessage(message)"></span>
                
				<span *ngIf="message.text_with_links && message.messageable_type=='Reply'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" ></span>
              </ng-container> 

              <ng-container *ngIf="message.locked_by_user && user.id != message.user_id && message.messageable_type == 'Room'">
                <span *ngIf="message.text_with_links" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" (click)="toolsPrvd.handleLinkClick($event)">
                  <i>[Message locked]</i>
                </span>
              </ng-container> 

             <span class="img-wrapper">
                <ng-container *ngIf="message.locked_by_user && user.id == message.user_id || !message.locked_by_user">
					<ng-container *ngIf="message.image_urls.length + message.video_urls.length > 1">
						<ion-slides *ngIf="message.image_urls.length || message.video_urls.length" pager="true" (ionSlideDidChange)="videoservice.messageSliderChange($event, pageTag)">
							<ion-slide *ngFor="let img of message.image_urls">
								<img (click)="imageViewer(img)" class="resize-img" [src]="img" (load)="chatPrvd.calcLoadedImages()"/>
							</ion-slide>
							<ion-slide *ngFor="let vid of message.video_urls" (tap)="videoservice.toggleVideoVolume($event)" class="video-container">
								<ion-icon class="volume" ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
								<video [poster]="vid.poster" loop playsinline muted>
									<source [src]="vid.url">
								</video>
							</ion-slide>
						</ion-slides>
					</ng-container>
                    <ng-container *ngIf="message.image_urls.length + message.video_urls.length <= 1">
                        <ng-container *ngIf="message.image_urls.length > 0">
                            <img (click)="imageViewer(j)" class="resize-img" *ngFor="let j of message.image_urls" src="{{j}}" (load)="chatPrvd.calcLoadedImages()"/>
                        </ng-container>
                        <ng-container *ngIf="message.video_urls.length > 0">
                            <div class="video-container" (tap)="videoservice.toggleVideoVolume($event)">
                                <ion-icon class="volume" ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                                <video *ngFor="let vid of message.video_urls" loop playsinline muted [poster]="vid.poster">
                                    <source [src]="vid.url">
                                </video>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </span>			
        </p>
		
		<div class="accessDiv accessBtnDiv" *ngIf = "message.conversation_status && user.id != message.user_id && message.conversation_status=='REQUESTED'">
			<button ion-button class="accept-access accessBtn" (click)="grantAccess('ACCEPT',message)">
				I'm in
			</button>

			<button ion-button class="reject-access accessBtn" (click)="grantAccess('REJECT',message)">
				I can't
			</button>
		</div> 
			

        <ng-container *ngIf = "!message.conversation_status && message.message_type != 'CONV_ACCEPTED'">
            <button class="feedback-button" (tap)="feedbackService.toggleLikes(message, user.id, $event);getGoodStuff('pinnedStuff'); " [ngClass]="{ 'disabled' : !isFeedbackClickable || !message.is_synced, 'active' : message.like_by_user}" *ngIf="!message.like_by_user && chatPrvd.areaLobby && !message.locked_by_user || !message.like_by_user && (chatPrvd.isLobbyChat && !netwrkFeed) && !message.locked_by_user || !message.like_by_user && chatPrvd.getState() == 'area' && !message.locked_by_user"  (press)="openFeedbackModal(message, i)">
              <div class="icon" [ngClass]="{'lobby' : chatPrvd.isLobbyChat}"></div>
            </button>
			
			<button class="legendary-btn" (tap)="toggleLikes(message)" [ngClass]="{ 'disabled' : !isFeedbackClickable || !message.is_synced, 'active' : message.legendary_by_user}" *ngIf="message.like_by_user && chatPrvd.areaLobby && !message.locked_by_user || message.like_by_user && (chatPrvd.isLobbyChat && !netwrkFeed) && !message.locked_by_user || message.like_by_user && chatPrvd.getState() == 'area' && !message.locked_by_user"  (press)="openFeedbackModal(message, i)">
              <div class="icon" [ngClass]="{'lobby' : chatPrvd.isLobbyChat}"></div>
            </button>

            <button ion-button class="feedback-follow" color="bk" item-end (click)="followNearByNetwork(message,i)"   *ngIf="user.id != message.user_id && !chatPrvd.areaLobby && (!chatPrvd.isLobbyChat || netwrkFeed) && chatPrvd.getState() != 'area' && (message.lines_count <= 0 || !message.is_followed) && !message.locked_by_user">
			<!-- [ngClass]="{ 'feedback-follow' : message.is_followed , 'feedback-unfollow' : !message.is_followed }"-->
                <ion-icon ios="ios-add" md="md-add" *ngIf="!message.is_followed"></ion-icon>
                <ion-icon ios="ios-remove" md="md-remove" *ngIf="message.is_followed"></ion-icon>
            </button>
					
            <button ion-button class="feedback-setting-button" color="bk" item-end (tap)="editSetting(message.id)" [ngClass]="{ 'isFollowed' : message.is_followed }"  *ngIf="message.lines_count <= 0 && chatPrvd.getState() != 'area' && user.id == message.user_id && !chatPrvd.areaLobby && (!chatPrvd.isLobbyChat || netwrkFeed) && message.messageable_type=='Network'">
                <ion-icon ios="ios-settings" md="md-settings"></ion-icon>
            </button>

            <button class="recast-button" [ngClass]="{ 'disabled' : !message.is_synced}" (click)="feedbackService.initNativeShare(message)" *ngIf="message.messageable_type!='Reply' && !message.locked_by_user">
                Share
            </button>
	
			<button ion-button class="feedback-setting-button down-btn ncl-btn" color="bk" item-end (click)="getNCL(message,$event,i)" *ngIf="message.message_type=='CUSTOM_LOCATION' && message.lines_count && !chatPrvd.isLobbyChat && chatPrvd.getState() != 'area' && !message.locked_by_user">
		      <ion-icon ios="ios-arrow-down" md="ios-arrow-down" class="arrow-down" ></ion-icon>
		      <ion-icon ios="ios-arrow-up" md="ios-arrow-up" class="arrow-up" ></ion-icon> 
			</button>  
			
        </ng-container>
		
		<ng-container *ngIf="user.id != message.user_id && message.locked_by_user">
            <button class="lock-button lock" (click)="showUnlockPostForm(message.id, message.hint)">
                <ion-icon ios="ios-lock" md="ios-lock"></ion-icon>
            </button>
        </ng-container>
      </div>
	
	  <div class="message-container false isLobby message-request 111" *ngIf="message.undercover && chatPrvd.isLobbyChat && message.message_type =='ACCESS_REQUEST' && chatPrvd.postLineMessages[0].user_id == user.id && message.deleted!=true">
	  <!-- <div *ngIf="isParentOwnerUser(message)"> -->
		
		<img *ngIf="message.user" (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)"
		[src]="message.public ? message.user.avatar_url : message.user.hero_avatar_url" class="chat-avatar 4 conversation"
		(error)="chatPrvd.updateAvatarUrl($event)">

		<img *ngIf="!message.user" (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)"
		[src]="toolsPrvd.defaultAvatar" class="chat-avatar 5 conversation"
		(error)="chatPrvd.updateAvatarUrl($event)">


		<!-- <span class="chat-bubbles-box" *ngIf="chatPrvd.areaLobby">
			<ion-icon ios="ios-chatbubbles-outline" md="ios-chatbubbles-outline"></ion-icon> : 8
		</span> -->

		<p class="message-item">
			<span class="username" *ngIf="message.user" (click)="openConversationLobbyForPinned(message)" (tap)="openConversationLobbyForPinned(message)">
				<ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
					{{ message.user.name }}
				</ng-container>
				<ng-container *ngIf="!message.public && message.locked_by_user">
					{{ message.role_name }}
				</ng-container>
			</span>

			<!-- <span class="message-date" (click)="openConversationLobbyForPinned(message)" (tap)="openConversationLobbyForPinned(message)">{{ message.dateStr }}</span> -->

			<!-- <span *ngIf="message.social" class="shared-status">Casted via {{ message.social }}
				<a *ngIf="message.post_url" href="#" (click)="openLinkInBrowser(message)" class="open-post" >				
					<ion-icon ios="ios-open-outline" md="ios-open-outline"></ion-icon>
				</a>
			</span> -->

			<!-- <span *ngIf="message.expire_at && !chatPrvd.isLobbyChat" class="visible-for">
				Expires in {{ message.expire_at }}
			</span> -->

			<!-- <ng-container *ngIf="!message.locked_by_user || (message.locked_by_user && user.id == message.user_id)">
				<span *ngIf="message.text_with_links" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="toolsPrvd.handleLinkClick($event)"></span>
			</ng-container> -->

			<img src="assets/icon/slider_arrow.svg" class="conversation_right_ico" (swipe)="changeRequestStatus(message,'REJECT')" >
		</p>

		<ng-container>
			<button ion-button class="recast-button" (click)="changeRequestStatus(message,'ACCEPT')" >
                Sure, say hello for me!
            </button>
		</ng-container>
	  <!-- </div> -->
	  </div>

	  <div class="message-conversasion 321" *ngIf="chatPrvd.areaLobby && message.message_type == 'CONV_REJECTED' && message.user.id == user.id">
	  <!-- <div *ngIf="isParentOwnerUser(message)"> -->		
		<p class="message-item">
			<ng-container *ngIf="!message.locked_by_user || (message.locked_by_user && user.id == message.user_id)">
				<span *ngIf="message.text_with_links" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="toolsPrvd.handleLinkClick($event)"></span>
			</ng-container>			
		</p>
	  <!-- </div> -->
	  </div> 
	  
	  <!-- && (user.id == message.user_id && message.messageable_type !='Room' || user.id != message.user_id)  -->
	  
	 <!--  {{(chatPrvd.getState() == 'area' || chatPrvd.isLobbyChat) }}
	  {{(!message.undercover || message.message_type == 'CONV_REQUEST') }} 
	  {{ message.message_type !='CONV_REJECTED'}} 
	  {{ message.conversation_status!='REJECTED' }}  -->
	  <!-- So not show self LM request in line/community: with ...'CONV_REQUEST' && message.user_id != user.id || ... -->
	  <div class="message-container false area-conversastions 654" 
	  *ngIf="(chatPrvd.getState() == 'area' || chatPrvd.isLobbyChat) && (message.message_type == 'CONV_REQUEST' || message.messageable_type == 'Network' && !message.undercover) && message.conversation_status!='REJECTED'" 
	  (click)="message.undercover?openLobbyForPinned(message):openConversationLobbyForPinned(message)">

		<img (click)="goToProfile(message.user_id, message.public, message.user.role_name)" (press)="goToProfile(message.user_id, message.public, message.user.role_name)"
         src="{{loadImage(message)}}" class="chat-avatar 6"
        (error)="chatPrvd.updateAvatarUrl($event)">
		
		
        <!-- <span class="message-count conversasion-cnt" *ngIf="!chatPrvd.isLobbyChat && chatPrvd.getState() == 'undercover' && message.messageable_type=='Network'">1</span> -->

        <!-- <span class="message-box" *ngIf="!chatPrvd.isLobbyChat && chatPrvd.getState() != 'area' && message.messageable_type=='Network' ||  chatPrvd.areaLobby">
            <ion-icon ios="ios-mail-outline" md="ios-mail-outline"></ion-icon>
        </span> -->
		
		<!-- && chatPrvd.getState() == 'area' -->
        <!-- <span class="chat-bubbles-box" *ngIf="!chatPrvd.areaLobby">
            <ion-icon ios="ios-chatbubbles-outline" md="ios-chatbubbles-outline"></ion-icon> : 8
        </span> -->

        <p class="message-item">

<!-- openLobbyForPinned(message)  openLobbyForLineMessage(message) --> 

         <span class="username" *ngIf="message.user && message.messageable_type=='Network'" (click)="message.undercover?openLobbyForPinned(message):openConversationLobbyForPinned(message)" (tap)="message.undercover?openLobbyForPinned(message):openConversationLobbyForPinned(message)">
            <ng-container *ngIf="message.public || !message.public && !message.locked_by_user">
				{{ message.title }}
			</ng-container>
			<ng-container *ngIf="!message.public && message.locked_by_user">
				{{ message.role_name }}
			</ng-container>
          </span>

          <span class="username" *ngIf="message.user && message.messageable_type=='Room' " (click)="message.undercover?openLobbyForLineMessage(message):openConversationMessage(message)" (tap)="message.undercover?openLobbyForLineMessage(message):openConversationMessage(message)">
            <ng-container *ngIf="message.message_type == 'CONV_REQUEST'">
            {{ message.title }} <!-- text_with_links -->
            </ng-container>
			
			<ng-container *ngIf="(message.public || !message.public && !message.locked_by_user) && message.message_type != 'CONV_REQUEST'">
            {{ message.user.name }}
            </ng-container>
            <ng-container *ngIf="(!message.public && message.locked_by_user) && message.message_type != 'CONV_REQUEST'">
            {{ message.user.role_name }}
            </ng-container>
          </span>
		  
		  <!-- {{ message.user.name}} -->
		  <!-- <span class="message-user"><data class="message-date">{{ message.dateStr }}</data> {{ message.place_name}}</span> -->
		  
		  <span class="date-visible-for">
            {{ message.dateStr }}
          </span>
          <span *ngIf="message.social" class="shared-status">Casted via {{ message.social }}
            <a *ngIf="message.post_url" href="#" (click)="openLinkInBrowser(message)" class="open-post" >	
              <ion-icon ios="ios-open-outline" md="ios-open-outline"></ion-icon>
            </a>
          </span>

          <!-- <span *ngIf="message.expire_at && !chatPrvd.isLobbyChat" class="visible-for">
            Expires in {{ message.expire_at }}
          </span> -->

          <ng-container *ngIf="message.locked">
            <ion-icon ios="ios-lock" md="ios-lock" class="locked-by-you info-icon"></ion-icon>
          </ng-container>

          <!-- <ng-container *ngIf="(!message.locked_by_user || (message.locked_by_user && user.id == message.user_id)) && message.message_type != 'CONV_REQUEST'">
                <span *ngIf="message.text_with_links && message.messageable_type=='Network'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="message.undercover?openLobbyForPinned(message):openConversationLobbyForPinned(message)"></span>
                <span *ngIf="message.text_with_links && message.messageable_type=='Room'" class="text" [ngClass]="{ 'emoji' : message.is_emoji }" [innerHTML]="message.text_with_links" (click)="message.undercover?openLobbyForLineMessage(message):openConversationMessage(message)"></span>
          </ng-container> -->
 
          <img src="assets/icon/slider_arrow.svg" class="conversation_right_ico" *ngIf="chatPrvd.getState() != 'undercover' && message.message_type != 'LOCAL_MESSAGE' && message.message_type != 'CONV_REQUEST'"  (tap)="openFeedbackModal(message, i)"  (press)="openFeedbackModal(message, i)">
		  
        </p>
		<div class="accessDiv"
		*ngIf = "message.conversation_status && user.id != message.user_id && message.conversation_status=='REQUESTED'"> <!-- *ngIf = "message.conversation_status" -->
			<button ion-button class="accept-access accessBtn" (click)="grantAccess('ACCEPT',message)">
				I'm in
			</button>

			<button ion-button class="reject-access accessBtn" (click)="grantAccess('REJECT',message)">
				I can't
			</button>
		</div> 
        <ng-container *ngIf="user.id != message.user_id && message.locked_by_user">
          <button class="feedback-button lock" (tap)="showUnlockPostForm(message.id, message.hint)">
            <ion-icon ios="ios-lock" md="ios-lock"></ion-icon>
          </button>
        </ng-container>

        <span class="img-wrapper">
            <ng-container *ngIf="message.locked_by_user && user.id == message.user_id || !message.locked_by_user">
              <ion-slides *ngIf="message.image_urls.length + message.video_urls.length > 1" pager="true" (ionSlideDidChange)="videoservice.messageSliderChange($event, pageTag)">
                <ion-slide *ngFor="let img of message.image_urls">
                  <img (click)="imageViewer(img)" class="resize-img" [src]="img" (load)="chatPrvd.calcLoadedImages()"/>
                </ion-slide>
                <ion-slide *ngFor="let vid of message.video_urls" (tap)="videoservice.toggleVideoVolume($event)" class="video-container">
                  <ion-icon class="volume" ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                  <video [poster]="vid.poster" loop playsinline muted>
                    <source [src]="vid.url">
                  </video>
                </ion-slide>
              </ion-slides>
              <ng-container *ngIf="message.image_urls.length + message.video_urls.length <= 1">
                <ng-container *ngIf="message.image_urls.length > 0">
                  <img class="resize-img"*ngFor="let j of message.image_urls" src="{{j}}" (load)="chatPrvd.calcLoadedImages()" (click)="imageViewer(j)"/>
                </ng-container>
                <ng-container *ngIf="message.video_urls.length > 0">
                  <div class="video-container" (tap)="videoservice.toggleVideoVolume($event)">
                    <ion-icon class="volume"
                    ios="ios-volume-off-outline" md="ios-volume-off-outline"></ion-icon>
                    <video *ngFor="let vid of message.video_urls" loop playsinline muted [poster]="vid.poster">
                      <source [src]="vid.url">
                    </video>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>
        </span>
		
      </div>
	  
	  
	</div>
  </div>


  <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
        <ion-infinite-scroll-content></ion-infinite-scroll-content>	
  </ion-infinite-scroll>
</ion-content>

<!--Footer-->
<ion-footer class="has-input chatFooter chatChatFooter" >
  <div item-content class="appended-pictures-container" [hidden]="chatPrvd.appendContainer.hidden" [@containerState]="chatPrvd.appendContainer.state" [ngClass]="{ 'netwrk' : !isUndercover }" *ngIf="cameraPrvd.takenPictures && cameraPrvd.takenPictures.length > 0 && (chatPrvd.isLobbyChat || chatPrvd.areaLobby || chatPrvd.getState() == 'area')">
    <div class="img-container" *ngFor="let img of cameraPrvd.takenPictures; let indx = index" >
	  <img class="img-preview" [src]="img" alt="{{ img }}"/>
      <button (click)="removeAppendedImage(indx)">
        <ion-icon ios="ios-close" md="ios-close"></ion-icon>
      </button>
    </div>
  </div>

  <div #emojiCont item-content class="gallery-container emoji-container" [hidden]="emojiContainer.hidden" [@containerState]="emojiContainer.state" *ngIf="chatPrvd.isLobbyChat || chatPrvd.areaLobby || chatPrvd.getState() == 'area'" [ngStyle]="{'padding-bottom': contentPadding, 'margin-bottom': contentMargin}" >
    <span item-content *ngFor="let emoji of emojis" (click)="insertEmoji(emoji)" class="emoji-item">{{ convertEmoji(emoji) }}</span>
  </div>

  <div #shareCont item-content class="gallery-container share-container" [hidden]="shareContainer.hidden" [@containerState]="shareContainer.state" *ngIf="chatPrvd.isLobbyChat || chatPrvd.areaLobby || chatPrvd.getState() == 'area'" [ngStyle]="{'padding-bottom': contentPadding, 'margin-bottom': contentMargin}" >
    <ion-toolbar [ngClass]="{ 'no-events' : !socialLoaderHidden }">
      <div class="slide-container sl-facebook">
        <div #slfb [ngClass]="{'active': shareCheckbox.facebook}" class="toggle-el"
          (click)="toggleShareSlider('facebook')">
          <span class="toggle-state" *ngIf="shareCheckbox.facebook">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.facebook">off</span>
          <div [ngClass]="{ 'right' : shareCheckbox.facebook }" class="toggleable">
            <ion-icon ios="logo-facebook" md="logo-facebook" color="facebook"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.facebook">
        </div>
      </div>

      <div class="slide-container sl-twitter" *ngIf="socialPrvd.connect.twitter">
        <div #sltw [ngClass]="{'active': shareCheckbox.twitter}" class="toggle-el"
          (click)="toggleShareSlider('twitter')">
          <span class="toggle-state" *ngIf="shareCheckbox.twitter">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.twitter">off</span>
          <div [ngClass]="{'right': shareCheckbox.twitter}" class="toggleable">
            <ion-icon ios="logo-twitter" md="logo-twitter" color="twitter"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.twitter">
        </div>
      </div>

      <div class="slide-container sl-instagram" *ngIf="socialPrvd.connect.instagram">
        <div #slln [ngClass]="{'active': shareCheckbox.instagram}" class="toggle-el"
          (click)="toggleShareSlider('instagram')">
          <span class="toggle-state" *ngIf="shareCheckbox.instagram">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.instagram">off</span>
          <div [ngClass]="{'right': shareCheckbox.instagram}" class="toggleable">
            <ion-icon ios="logo-instagram" md="logo-instagram"
              color="instagram"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.instagram">
        </div>
      </div>
    </ion-toolbar>

    <div class="share-content">
      <ion-spinner name="ios" class="share-spinner" [hidden]="socialLoaderHidden"></ion-spinner>
      <ng-container *ngFor="let post of socialPosts">
        <ng-container *ngIf="post.text_with_links || post.image_urls.length > 0">
          <div (click)="postMessageFromSocial(post)" class="img-container">

            <ng-container *ngIf="post.social == 'facebook'">
              <ion-icon ios="logo-facebook" md="logo-facebook"
              class="social-ico" color="facebook"></ion-icon>
            </ng-container>

            <ng-container *ngIf="post.social == 'twitter'">
              <ion-icon ios="logo-twitter" md="logo-twitter"
              class="social-ico" color="twitter"></ion-icon>
            </ng-container>

            <ng-container *ngIf="post.social == 'instagram'">
              <ion-icon ios="logo-instagram" md="logo-instagram"
              class="social-ico" color="instagram"></ion-icon>
            </ng-container>

            <p *ngIf="post.text_with_links" class="message {{ post.social }}" [innerHTML]="post.text_with_links" [ngClass]="{'with-media': post.image_urls.length > 0 || (post.video_urls && post.video_urls.length > 0)}"></p>

            <ion-slides *ngIf="post.image_urls.length + post.video_urls.length > 1" pager="true" (ionSlideDidChange)="videoservice.messageSliderChange($event, pageTag)">
              <ion-slide *ngFor="let img of post.image_urls">
                <img [src]="img" (load)="chatPrvd.calcLoadedImages()"/>
              </ion-slide>
              <ion-slide *ngFor="let vid of post.video_urls">
                <video [poster]="vid.poster" loop muted playsinline>
                  <source [src]="vid.url">
                </video>
              </ion-slide>
            </ion-slides>

            <ng-container *ngIf="post.image_urls.length + post.video_urls.length <= 1">
              <ng-container *ngIf="post.image_urls.length > 0">
                <img *ngFor="let j of post.image_urls" [src]="j" (load)="chatPrvd.calcLoadedImages()"/>
              </ng-container>
              <ng-container *ngFor="let vid of post.video_urls">
                <video [poster]="vid.poster" loop muted playsinline>
                  <source [src]="vid.url">
                </video>
              </ng-container>
            </ng-container>
          </div>
        </ng-container>
        <ng-container *ngIf="!post.image_urls && post.text_with_links">
          <p (click)="postMessageFromSocial(post)" class="message {{ post.social }}" [innerHTML]="post.text_with_links"></p>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <div class="tip tail-bottom" *ngIf="chatPrvd.networkAvailable == true && !settings.isNewlineScope">
    You're in a new area
  </div>
  
  
  <div class="tip tail-bottom" [ngClass]="{'networks-visible':netwrkCoachMarkText}" *ngIf="(settings.isNewlineScope || chatPrvd.isLobbyChat) && !netwrkCoachMarkText" [ngStyle]="{'display': coachMarkText!=''?'inline':'none'}" (press)="netwrkCoachMarkText?getVisibleNetwrks():''">{{coachMarkText}}</div> 
  
  <div class="tip tail-bottom near-netwrks" [ngClass]="{'networks-visible':netwrkCoachMarkText}" *ngIf="netwrkCoachMarkText" [ngStyle]="{'display': coachMarkText!=''?'inline-flex':'none'}" (press)="netwrkCoachMarkText?getVisibleNetwrks():''">New networks are visible. Tap <img src='assets/icon/blue.png' class='netwrk-img'> to see them</div> 

  <button ion-button class="back-nav-btn" (tap)="goBack();" clear *ngIf="settings.isNewlineScope == true">
        <span ion-text>No, I’ll move elsewhere</span>
  </button>

  <button class="{{chatPrvd.mainBtn.state}}" isScrolling="false" [hidden]="chatPrvd.mainBtn.hidden" *ngIf="settings.isNewlineScope" [@mainBtnState]="chatPrvd.mainBtn.state" color="bk" class="main-action-btn has-footer transparent chatMainBtn" [disabled]="chatPrvd.isMainBtnDisabled" (press)="normalizeMainBtn($event); goToHoldScreen()" (click)="normalizeMainBtn($event,'openLinePage');" [ngClass]="{'anim-glow' : chatPrvd.networkAvailable && chatPrvd.localStorage.get('firstTimeAreaChange') === null, 'small' :  chatPrvd.mainBtn.getState() == 'back-to-hold', 'big' : chatPrvd.mainBtn.getState() != 'back-to-hold'}" >
    <ion-icon ios="ios-arrow-forward-outline" md="ios-arrow-forward-outline"></ion-icon>
  </button>
  
  <button class="{{chatPrvd.mainBtn.state}}" isScrolling="false" [hidden]="chatPrvd.mainBtn.hidden" *ngIf="!settings.isNewlineScope" [@mainBtnState]="chatPrvd.mainBtn.state" color="bk" class="main-action-btn has-footer transparent chatMainBtn" 
  (press)="normalizeMainBtn($event); goToHoldScreen()" 
  (click)="netwrkFeed ? getLobbyMessages(chatPrvd.currentLobbyMessage): normalizeMainBtn($event,'handleMainBtnClick')"

  [disabled]="chatPrvd.isMainBtnDisabled" [ngClass]="{'anim-glow' : chatPrvd.networkAvailable && chatPrvd.localStorage.get('firstTimeAreaChange') === null, 'small' :  chatPrvd.mainBtn.getState() == 'back-to-hold', 'big' : chatPrvd.mainBtn.getState() != 'back-to-hold'}"  >
   <ion-icon ios="ios-arrow-back-outline" md="ios-arrow-back-outline" *ngIf="isReplyMode"></ion-icon>
  </button>


  <button class="netwrk-button" (click)="loadMaps(); " *ngIf="isUndercover && !chatPrvd.isLobbyChat && !settings.isNewlineScope && chatPrvd.getState() == 'undercover' && !netwrkFeed">
      <img src="assets/icon/netwrk_add.png"/>
  </button>

  <div class="flip-container hover" [ngClass]="{'hover' : flipHover }" *ngIf="(chatPrvd.isLobbyChat || chatPrvd.areaLobby  || isReplyMode) && !hideTextContainer">

    <ion-item class="text front" #inputItem *ngIf="(chatPrvd.currentLobby.currentUserPresent && chatPrvd.isLobbyChat) || !mainInput.hidden" [@fadeState]="mainInput.state" [ngClass]="{ 'has-post-btn' : chatPrvd.postBtn.state}">
      <div item-content id="textInpBtns" [@bgState]="chatPrvd.bgState.state">
        <button class="noBtn" ion-button [@inputState]="chatPrvd.chatBtns.state[0]" (click)="openCamera();
                   toggleContainer(emojiContainer, 'hide');
                   toggleContainer(shareContainer, 'hide')">
          <ion-icon ios="ios-camera-outline" md="ios-camera-outline"></ion-icon>
        </button>
        <button class="noBtn" ion-button [@inputState]="chatPrvd.chatBtns.state[1]"
          (click)="chatPrvd.openGallery(); toggleContainer(emojiContainer, 'hide'); toggleContainer(shareContainer, 'hide')">
           <ion-icon ios="ios-image-outline" md="ios-image-outline"></ion-icon>
        </button>

        <button class="noBtn" ion-button [@inputState]="chatPrvd.chatBtns.state[2]" *ngIf="chatPrvd.getState() == 'area' && !chatPrvd.isLobbyChat && !chatPrvd.areaLobby" (click)="toggleContainer(shareContainer, null, 'shareContainer');">
          <ion-icon ios="ios-redo" md="ios-redo"></ion-icon>
        </button>

        <button class="noBtn" ion-button [@inputState]="chatPrvd.chatBtns.state[2]" *ngIf="chatPrvd.getState() == 'undercover' || chatPrvd.isLobbyChat || chatPrvd.areaLobby"
          (click)="toggleContainer(shareContainer, null, 'shareContainer');">
          <ion-icon ios="ios-redo" md="ios-redo"></ion-icon>
        </button>

        <button class="noBtn" ion-button [@inputState]="chatPrvd.chatBtns.state[3]" (click)="toggleContainer(emojiContainer);">
          <ion-icon ios="ios-happy-outline" md="ios-happy-outline"></ion-icon>
        </button>
        <button ion-button [@inputState]="chatPrvd.chatBtns.state[4]"></button>
      </div>

      <button ion-button (click)="toggleChatOptions(); toggleContainer(emojiContainer, 'hide'); toggleContainer(shareContainer, 'hide')" [@rotState]="chatPrvd.plusBtn.state" ion-button item-left clear id="plus-btn">
        <ion-icon ios="ios-add" md="ios-add"></ion-icon>
      </button>

      <ion-input #textInput id="textInput" type="text"
        [placeholder]="placeholderText"
        (keyup)="getCaretPos(textInput); calculateInputChar(textInput)"
        (tap)="hideTopSlider(activeTopForm);"
        (focus)="inputOnFocus()" 
		(blur)="inputOnBlur()">
      </ion-input>
	   
      <button ion-button item-right clear [ngClass]="{ 'post-button' : chatPrvd.postBtn.state, 'disabled' : chatPrvd.postBtn.disabled }" (tap)="postMessage()" class="post-message">
	  
		<div class="text-profile-container" (click)="tapForProfileChange(user.id, user.profileTypePublic, user.role_name)" *ngIf="textProfile && cameraPrvd.takenPictures.length <= 0">
			<img class="text-profile-img" [src]="slideAvatarPrvd.sliderPosition == 'right' ? user.hero_avatar_url : user.avatar_url"
			  (error)="chatPrvd.updateAvatarUrl($event)"> 
		</div>
        <img *ngIf="!chatPrvd.postBtn.state && !isUndercover" src="assets/icon/netwrk-chat.png">
        <ng-container *ngIf="!chatPrvd.isLobbyChat && (!textProfile || cameraPrvd.takenPictures.length > 0)">
          <span *ngIf="chatPrvd.postBtn.state && !isUndercover && chatPrvd.bgState.state != 'stretched'">Post</span>
          <span *ngIf="chatPrvd.postBtn.state && isUndercover && chatPrvd.bgState.state != 'stretched'">Hang</span>
        </ng-container>
        <span *ngIf="chatPrvd.isLobbyChat && chatPrvd.postBtn.state && (!textProfile || cameraPrvd.takenPictures.length > 0)" class="lobby-bubble">
          <ion-icon ios="ios-text" md="ios-text"></ion-icon>
        </span>
        <ion-icon *ngIf="!chatPrvd.postBtn.state && isUndercover && !textProfile" ios="ios-text-outline" md="ios-text-outline"></ion-icon>
		
      </button>
    </ion-item>
  </div>
</ion-footer>
