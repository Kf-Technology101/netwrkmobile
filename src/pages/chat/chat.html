<ion-header class="incognito-header" isScrolling="false"
  [ngClass]="{'chat-header': !isUndercover}">
  <ion-toolbar *ngIf="isUndercover">
    <div class="drag-container">
      <div class="dragline">
        <span class="info">
          <span *ngIf="slideAvatarPrvd.sliderPosition == 'left'" class="username">
            {{ user.name }}
          </span>
          <span *ngIf="slideAvatarPrvd.sliderPosition == 'right'" class="username">
            {{ user.role_name }}
          </span>
        </span>
        <ion-icon ios="ios-log-out" md="ios-log-out"></ion-icon>
        <img class="draggable-element" (click)="goToProfile()"
          [src]="slideAvatarPrvd.sliderPosition == 'right'
            ? user.hero_avatar_url : user.avatar_url">
      </div>
    </div>

    <button *ngIf="isUndercover && postMessages.length === 0 && !chatPrvd.postBtn.state"
            class="side refresh-btn top-icon" (click)="startMessageUpdateTimer()"
            [hidden]="!canRefresh" ion-button>
      <ion-icon ios="md-refresh-circle" md="md-refresh-circle"></ion-icon>
    </button>
    <button ion-button class="side clear-btn" (click)="clearMessages()"
            *ngIf="isUndercover && postMessages.length > 0 && !chatPrvd.postBtn.state">
      Clear
    </button>

    <button ion-button *ngIf="isUndercover && chatPrvd.postBtn.state"
            class="side lock-btn top-icon" (click)="toggleTopSlider('lock')">
      <ion-icon ios="ios-lock" md="ios-lock"></ion-icon>
    </button>
    <button ion-button *ngIf="isUndercover && chatPrvd.postBtn.state"
            class="side left timer-btn top-icon" (click)="toggleTopSlider('timer')"
            [ngClass]="{'active' : debug.postHangTime != 0}">
      <ion-icon ios="ios-timer-outline" md="ios-timer-outline"></ion-icon>
    </button>
    <ion-badge *ngIf="debug.postHangTime != 0 && chatPrvd.postBtn.state && isUndercover">
      {{ debug.postHangTime }}
    </ion-badge>

  </ion-toolbar>

  <ion-toolbar [hidden]="postTimer.hidden" [@slideState]="postTimer.state"
    class="post-timer">
    <button (click)="setPostTimer(0)">None</button>
    <button (click)="setPostTimer(10, 'h')">10 hours</button>
    <button (click)="setPostTimer(1, 'd')">1 day</button>
    <button (click)="setPostTimer(1, 'w')">1 week</button>
    <button (click)="setPostTimer(1, 'm')">1 month</button>
  </ion-toolbar>

  <ion-toolbar [hidden]="postLock.hidden" [@slideState]="postLock.state"
    class="post-lock">
    <form (submit)="sendLockInfo(lockForm)" #lockForm="ngForm">
      <ion-item>
        <ion-input type="password" placeholder="Password" name="password"
          [(ngModel)]="postLockData.password" required></ion-input>
      </ion-item>
      <ion-item>
        <ion-input type="text" placeholder="Hint" name="hint"
          [(ngModel)]="postLockData.hint" required></ion-input>
      </ion-item>
      <button ion-button type="submit" class="submit"
              *ngIf="postLockData.password && postLockData.hint">Lock it</button>
    </form>
    <button color="bk" class="back" (click)="toggleTopSlider('lock')"></button>
  </ion-toolbar>

  <div *ngIf="!isUndercover" class="netwrk-header">
    <ion-toolbar class="area-head">
      <img [src]="user.avatar_url ? user.avatar_url : toolsPrvd.defaultAvatar"
        (click)="goToProfile()" class="ic user-icon">

      <img class="ic legendary-icon" src="assets/images/sun_icon.png">
    </ion-toolbar>
    <ion-toolbar>
      <ion-slides slidesPerView="4" class="netwrk-slider">
        <ion-slide *ngIf="!chatPrvd.users[user.id]" class="netwrk-slide"
          (click)="joinToNetwork()">
          <div class="avatar add-to-netwrk">
            <img src="assets/images/netwrk_plus.svg">
          </div>
        </ion-slide>
        <ion-slide *ngFor="let user of chatUsers" class="netwrk-slide">
          <div class="avatar" (click)="goToProfile(user.id)">
            <img [src]="chatPrvd.users[user.id].avatar_url">
          </div>
          <span *ngIf="user.name" class="username">
            {{ user.name }}
          </span>
          <span *ngIf="!user.name" class="username">
            {{ user.email }}
          </span>
        </ion-slide>
      </ion-slides>
    </ion-toolbar>
  </div>

</ion-header>

<ion-content has-main-btn has-main-btn-label
  [ngClass]="{'netwrk-content': !isUndercover}"
  [ngStyle]="{'padding-bottom': contentPadding}">
  <ion-refresher (ionRefresh)="refreshChat($event)">
    <ion-refresher-content
      pullingIcon="arrow-dropdown"
      pullingText="Pull to refresh"
      refreshingSpinner="ios">
    </ion-refresher-content>
  </ion-refresher>
  <div class="chat-container" #chatContainer>
    <div class="message" *ngFor="let message of postMessages; let i = index"
         [@fadeState]="'fadeInVeryFast'">
      <img *ngIf="chatPrvd.users[message.user_id]"
        (click)="goToProfile(message.user_id, message.public)"
        [src]="message.public
          ? chatPrvd.users[message.user_id].avatar_url
          : chatPrvd.users[message.user_id].hero_avatar_url"
        class="chat-avatar">
      <img *ngIf="!chatPrvd.users[message.user_id]"
        (click)="goToProfile(message.user_id, message.public)"
        [src]="toolsPrvd.defaultAvatar"
        class="chat-avatar">
      <p class="message-container">
        <span class="username" *ngIf="chatPrvd.users[message.user_id]">
          <ng-container *ngIf="message.public">
            {{ chatPrvd.users[message.user_id].name }}
          </ng-container>
          <ng-container *ngIf="!message.public">
            {{ chatPrvd.users[message.user_id].role_name }}
          </ng-container>
        </span>
        <span class="message-date">{{ message.dateStr }}</span>
        <span *ngIf="message.isTemporary" class="visible-for">
          <ion-icon ios="ios-time-outline" md="ios-time-outline"></ion-icon>
          {{ message.temporaryFor }}
        </span>
        <span *ngIf="message.text" class="text"
              [ngClass]="{ 'emoji' : message.is_emoji }">{{ message.text }}</span>
      </p>
      <button class="feedback-button" (click)="sendFeedback(message, i)"
        *ngIf="!message.locked">
      </button>
      <button class="feedback-button lock"
        *ngIf="message.locked">
        <ion-icon ios="ios-lock" md="ios-lock"></ion-icon>
      </button>
      <img *ngFor="let j of message.image_urls" src="{{j}}"/>
    </div>
  </div>
</ion-content>

<ion-footer class="has-input chatFooter">

  <div item-content class="appended-pictures-container"
    [hidden]="chatPrvd.appendContainer.hidden"
    [@containerState]="chatPrvd.appendContainer.state">
    <div class="img-container" *ngFor="let i of cameraPrvd.takenPictures; let indx = index" >
      <img class="img-preview" [src]="i"/>
      <button (click)="removeAppendedImage(indx)">
        <ion-icon ios="ios-close" md="ios-close"></ion-icon>
      </button>
    </div>
  </div>

  <div #emojiCont item-content class="gallery-container emoji-container"
    [hidden]="emojiContainer.hidden" [@containerState]="emojiContainer.state">
    <span item-content *ngFor="let emoji of emojis" (click)="insertEmoji(emoji)"
      class="emoji-item">{{ convertEmoji(emoji) }}</span>
  </div>

  <div #shareCont item-content class="gallery-container share-container"
    [hidden]="shareContainer.hidden" [@containerState]="shareContainer.state">
    <ion-toolbar>
      <div class="slide-container sl-facebook">
        <div #slfb [ngClass]="{'active': shareCheckbox.facebook}" class="toggle-el"
          (click)="toggleShareSlider('facebook')">
          <span class="toggle-state" *ngIf="shareCheckbox.facebook">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.facebook">off</span>
          <div [ngClass]="{'right': shareCheckbox.facebook}" class="toggleable">
            <ion-icon ios="logo-facebook" md="logo-facebook"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.facebook">
        </div>
      </div>

      <!-- <div class="slide-container sl-linkedin">
        <div #slln [ngClass]="{'active': shareCheckbox.linkedin}" class="toggle-el"
          (click)="toggleShareSlider('linkedin')">
          <span class="toggle-state" *ngIf="shareCheckbox.linkedin">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.linkedin">off</span>
          <div [ngClass]="{'right': shareCheckbox.linkedin}" class="toggleable">
            <ion-icon ios="logo-linkedin" md="logo-linkedin"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.linkedin">
        </div>
      </div>

      <div class="slide-container sl-twitter">
        <div #sltw [ngClass]="{'active': shareCheckbox.twitter}" class="toggle-el"
          (click)="toggleShareSlider('twitter')">
          <span class="toggle-state" *ngIf="shareCheckbox.twitter">on</span>
          <span class="toggle-state" *ngIf="!shareCheckbox.twitter">off</span>
          <div [ngClass]="{'right': shareCheckbox.twitter}" class="toggleable">
            <ion-icon ios="logo-twitter" md="logo-twitter"></ion-icon>
          </div>
          <input type="checkbox" [checked]="shareCheckbox.twitter">
        </div>
      </div> -->

    </ion-toolbar>

    <div ion-content class="share-content">
      <ng-container *ngFor="let post of socialPosts">
        <ng-container *ngIf="post.full_picture">
          <div *ngIf="post.message || post.full_picture" (click)="postMessageFromSocial(post)" class="img-container">
            <span *ngIf="!post.message" class="social-ico {{ post.type }}"></span>
            <p *ngIf="post.message" class="message {{ post.type }}">
              {{ post.message }}
            </p>
            <img [src]="post.full_picture">
          </div>
        </ng-container>
        <ng-container *ngIf="!post.full_picture && post.message">
          <p (click)="postMessageFromSocial(post)"
            class="message {{ post.type }}">{{ post.message }}</p>
        </ng-container>
      </ng-container>
      <!-- <div class="img-container">
        <span class="social-ico linkedin"></span>
        <img src="http://travel.usnews.com/images/destinations/94/yosemite_mirror_lake_getty_michael_h_spiva.jpg">
      </div>
      <p class="message twitter">
        The first rule of magic is simple. Don't waste your time waving your hands and hoping when a rock or a club will do.
      </p>
      <p class="message twitter">
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facilis deleniti perspiciatis sit, obcaecati ut blanditiis aliquid alias rem impedit odit vitae maiores voluptate exercitationem. Perferendis modi eius distinctio illum labore.
      </p> -->
    </div>

  </div>

  <button isScrolling="false" tapable [hidden]="chatPrvd.mainBtn.hidden"
    [@mainBtnState]="chatPrvd.mainBtn.state" color="bk"
    class="main-action-btn big has-footer transparent chatMainBtn"
    (click)="goUndercover()"></button>

  <div ion-content class="flip-container" [ngClass]="{'hover' : flipHover}">
    <ion-item class="text front" #inputItem
              [@fadeState]="mainInput.state" [hidden]="mainInput.hidden"
              [ngClass]="{ 'has-post-btn' : chatPrvd.postBtn.state}">
      <div item-content id="textInpBtns" [@bgState]="bgState.state">
        <button ion-button [@inputState]="chatBtns.state[0]"
        (click)="openCamera();
              toggleContainer(emojiContainer, 'hide');
              toggleContainer(shareContainer, 'hide')">
          <ion-icon ios="ios-camera-outline" md="ios-camera-outline"></ion-icon>
        </button>
        <button ion-button [@inputState]="chatBtns.state[1]"
          (click)="chatPrvd.openGallery()">
           <ion-icon ios="ios-image-outline" md="ios-image-outline"></ion-icon>
        </button>
        <button ion-button [@inputState]="chatBtns.state[2]"
          (click)="toggleContainer(shareContainer, null, 'shareContainer');">
          <ion-icon ios="ios-redo" md="ios-redo"></ion-icon>
        </button>
        <button ion-button [@inputState]="chatBtns.state[3]"
          (click)="toggleContainer(emojiContainer);">
          <ion-icon ios="ios-happy-outline" md="ios-happy-outline"></ion-icon>
        </button>
        <button ion-button [@inputState]="chatBtns.state[4]"></button>
      </div>

      <button ion-button
        (click)=" toggleChatOptions();
          toggleContainer(emojiContainer, 'hide');
          toggleContainer(shareContainer, 'hide')"
        [@rotState]="chatOptions.state" ion-button item-left clear
        id="plus-btn">
        <ion-icon ios="ios-add" md="ios-add"></ion-icon>
      </button>

      <ion-input #textInput id="textInput" type="text"
        [placeholder]="placeholderText"
        (keyup)="getCaretPos(textInput); calculateInputChar(textInput)">
      </ion-input>
    <!-- <div #textInput id="textInput" type="textShortMessage" contenteditable=""></div> -->

      <button ion-button item-right clear
        [ngClass]="{ 'post-button' : chatPrvd.postBtn.state }"
        (tap)="postMessage()" class="post-message">
        <img *ngIf="!chatPrvd.postBtn.state && !isUndercover"
          src="assets/icon/netwrk-chat.svg">
        <span *ngIf="chatPrvd.postBtn.state
          && !isUndercover && bgState.state != 'stretched'">Post</span>
        <span *ngIf="chatPrvd.postBtn.state
          && isUndercover && bgState.state != 'stretched'">Hang</span>
        <ion-icon *ngIf="!chatPrvd.postBtn.state && isUndercover"
        ios="ios-text-outline" md="ios-text-outline"></ion-icon>
      </button>
    </ion-item>
  </div>
</ion-footer>
